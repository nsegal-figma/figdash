---
id: VIZ-010
title: "Color Palette System"
type: Task
epic: E2
status: Draft
priority: Critical
storyPoints: 3
sprint: 2
dependencies: ["VIZ-009"]
---

# Story E2.010: Color Palette System

## Status
Completed

## Story
As a frontend engineer I want to color utilities with accessibility checking So that all chart colors meet WCAG AA standards and support color-blind users

## Description


## Acceptance Criteria
1. Color utility functions created
2. WCAG contrast checker (4.5:1 minimum)
3. Sequential color scale generator
4. Diverging color scale generator
5. Categorical palette (8-12 colors)
6. Color blindness simulation support
7. Dark mode color variants
8. Auto-adjustment for accessibility

## Tasks / Subtasks

- [x] Task 1: Create color utility functions
  - [x] generateSequentialScale() - Create light-to-dark gradients
  - [x] generateDivergingScale() - Create negative-to-positive scales
  - [x] generateCategoricalPalette() - Generate distinct color sets (2-12 colors)
  - [x] adjustBrightness() - Lighten or darken colors
- [x] Task 2: Implement WCAG contrast validation (already in VIZ-009)
  - [x] getContrastRatio() - Calculate contrast between two colors
  - [x] meetsWCAG_AA() - Validate 4.5:1 minimum contrast
  - [x] autoAdjustContrast() - Auto-adjust colors to meet WCAG AA
- [x] Task 3: Add color blindness simulation
  - [x] simulateColorBlindness() - Protanopia, Deuteranopia, Tritanopia
  - [x] checkColorBlindAccessibility() - Validate palette distinguishability
- [x] Task 4: Create dark mode support
  - [x] generateDarkModeVariant() - Convert light color to dark mode
  - [x] generateDarkModePalette() - Convert entire palette to dark mode
- [x] Task 5: Write comprehensive tests (29 tests, all passing)
  - [x] Sequential scale generation tests
  - [x] Diverging scale generation tests
  - [x] Categorical palette tests
  - [x] Brightness adjustment tests
  - [x] Color blindness simulation tests
  - [x] Auto-adjust contrast tests
  - [x] Dark mode generation tests

## Dev Notes
_To be filled during story planning_

### Testing
_To be filled during story planning_

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-11-19 | 1.0 | Initial story creation from conversion | SM |
| 2025-11-20 | 1.1 | Color utility system implemented and tested | James (Dev) |

## Dev Agent Record

### Agent Model Used
Claude Sonnet 4.5 (claude-sonnet-4-5-20250929[1m])

### Debug Log References
No debug log required - implementation completed successfully.

### Completion Notes List

**Implementation Summary:**

Extended design token system with comprehensive color utilities for dynamic color generation, accessibility validation, and color-blind user support.

**Key Features Implemented:**

1. **Color Scale Generators:**
   - `generateSequentialScale()` - Creates light-to-dark gradients (any base color, customizable steps)
   - `generateDivergingScale()` - Creates negative-to-positive two-tone scales with neutral center
   - `generateCategoricalPalette()` - Returns 2-12 maximally distinct colors optimized for color-blind accessibility

2. **Accessibility Utilities:**
   - `getContrastRatio()` - Calculate WCAG contrast ratio between colors (from VIZ-009)
   - `meetsWCAG_AA()` - Validate 4.5:1 (text) or 3:1 (graphics) contrast (from VIZ-009)
   - `autoAdjustContrast()` - Automatically darken/lighten colors to meet WCAG AA target

3. **Color Blindness Support:**
   - `simulateColorBlindness()` - Simulate Protanopia (red-blind), Deuteranopia (green-blind), Tritanopia (blue-blind)
   - `checkColorBlindAccessibility()` - Validate entire palette is distinguishable for color-blind users
   - Based on Brettel et al. (1997) and Viénot et al. (1999) transformation matrices

4. **Dark Mode Support:**
   - `generateDarkModeVariant()` - Convert single light mode color to dark mode (ensures WCAG AA on dark backgrounds)
   - `generateDarkModePalette()` - Convert entire light palette to dark mode equivalents

5. **Helper Functions:**
   - `adjustBrightness()` - Lighten (+) or darken (-) color by factor
   - Internal: hexToRgb(), rgbToHex(), colorDistance() for color manipulation

**Accessibility Achievements:**
- Auto-adjustment ensures all generated colors can be made WCAG AA compliant
- Color blindness simulation enables designers to preview how color-blind users see charts
- Dark mode generation maintains WCAG AA contrast on dark backgrounds (gray-800)
- Categorical palette pre-optimized with maximally distinct colors

**Test Coverage:**
- ✅ 29 tests for color utilities (all passing)
- ✅ 35 tests for base design tokens (from VIZ-009)
- ✅ **Total: 64 tests passing**
- Tests verify scale generation, accessibility checking, color blindness simulation, dark mode

**Integration with VIZ-009:**
- Built on top of base color tokens defined in VIZ-009
- Re-exports WCAG utilities (getContrastRatio, meetsWCAG_AA) for convenience
- Provides dynamic generation while VIZ-009 provides static token values

### File List

**Created:**
- `src/lib/designTokens/colorUtils.ts` - Color utility functions
- `src/lib/designTokens/colorUtils.test.ts` - Comprehensive tests (29 tests)

**Modified:**
- `src/lib/designTokens/index.ts` - Added colorUtils exports

## QA Results
_To be filled during QA review_
