---
id: VIZ-012
title: "Spacing & Layout System"
type: Task
epic: E2
status: Draft
priority: Medium
storyPoints: 2
sprint: 2
dependencies: ["VIZ-009"]
---

# Story E2.012: Spacing & Layout System

## Status
Completed

## Story
As a frontend engineer, I want to layout utilities for chart margins So that charts have consistent spacing and responsive sizing

## Description


## Acceptance Criteria
1. Margin calculation utilities
2. Responsive size calculator
3. Aspect ratio helpers
4. Container query support
5. Breakpoint utilities
6. Grid layout helpers
7. All based on 8px system

## Tasks / Subtasks

- [x] Task 1: Create margin calculation utilities
  - [x] calculateChartMargins() - Responsive margins based on container size
  - [x] Larger margins for axes (bottom for X, left for Y)
  - [x] All margins rounded to 8px multiples
  - [x] calculateInnerDimensions() - Chart area excluding margins
- [x] Task 2: Add responsive size calculator
  - [x] calculateChartDimensions() - Maintain aspect ratio within container
  - [x] getResponsiveChartHeight() - Height based on breakpoint
  - [x] Breakpoint-aware sizing (250px sm → 450px 2xl)
- [x] Task 3: Create aspect ratio helpers
  - [x] aspectRatios constants (16:9, 4:3, 3:2, 1:1, 2:1, golden)
  - [x] calculateChartDimensions() maintains aspect ratio
- [x] Task 4: Add breakpoint utilities
  - [x] breakpoints constants (sm: 640, md: 768, lg: 1024, xl: 1280, 2xl: 1536)
  - [x] getCurrentBreakpoint() - Detect current breakpoint
  - [x] meetsBreakpoint() - Check if width meets minimum breakpoint
- [x] Task 5: Create grid layout helpers
  - [x] calculateChartGrid() - Multi-chart grid layout (columns, rows, dimensions, gaps)
  - [x] getOptimalChartsPerRow() - Calculate optimal chart count per row
  - [x] Responsive: 1 col mobile, 2 col tablet, 3 col desktop
- [x] Task 6: Add container query support
  - [x] supportsFeature() - Check if container supports legend/tooltip/annotations
  - [x] getSpacingPx() - Convert spacing tokens to pixels
- [x] Task 7: Write comprehensive tests (54 tests, all passing)
  - [x] Margin calculation tests
  - [x] Aspect ratio tests
  - [x] Breakpoint detection tests
  - [x] Grid layout tests
  - [x] Integration tests (margins + inner = total)
  - [x] Edge case tests (tiny/huge containers, extreme aspect ratios)

## Dev Notes
_To be filled during story planning_

### Testing
_To be filled during story planning_

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-11-19 | 1.0 | Initial story creation from conversion | SM |
| 2025-11-20 | 1.1 | Spacing & layout utilities implemented and tested | James (Dev) |

## Dev Agent Record

### Agent Model Used
Claude Sonnet 4.5 (claude-sonnet-4-5-20250929[1m])

### Debug Log References
No debug log required - implementation completed successfully.

### Completion Notes List

**Implementation Summary:**

Created comprehensive spacing and layout utility system for responsive chart sizing, margin calculation, and grid layouts - all based on 8px spacing system.

**Key Features Implemented:**

1. **Margin Calculation:**
   - `calculateChartMargins()` - Responsive margins scaled to container size
   - Larger bottom margin for X axis labels (40px base)
   - Larger left margin for Y axis labels (48px base)
   - All margins rounded to 8px multiples for consistency
   - `calculateInnerDimensions()` - Chart rendering area (total - margins)

2. **Responsive Sizing:**
   - `getResponsiveChartHeight()` - Breakpoint-based heights (250px sm → 450px 2xl)
   - `calculateChartDimensions()` - Maintain aspect ratio within container
   - Handles both width-constrained and height-constrained scenarios

3. **Aspect Ratio System:**
   - Pre-defined ratios: 16:9, 4:3, 3:2, 1:1, 2:1, golden (1.618)
   - `calculateChartDimensions()` ensures perfect aspect ratio maintenance
   - Returns integer dimensions for crisp rendering

4. **Breakpoint System:**
   - Breakpoints: sm (640), md (768), lg (1024), xl (1280), 2xl (1536)
   - `getCurrentBreakpoint()` - Detect current breakpoint from width
   - `meetsBreakpoint()` - Check if width meets minimum breakpoint
   - Aligned with Tailwind CSS breakpoints

5. **Grid Layout Helpers:**
   - `calculateChartGrid()` - Complete grid config (columns, rows, dimensions, gaps)
   - Responsive columns: 1 (mobile), 2 (tablet), 3 (desktop)
   - `getOptimalChartsPerRow()` - Calculate optimal chart count
   - Gap sizing: 16px (mobile), 24px (tablet), 32px (desktop)

6. **Container Query Support:**
   - `supportsFeature()` - Check if container supports legend (400px), tooltip (200px), annotations (500px), title (300px)
   - `getSpacingPx()` - Convert spacing tokens to pixels (1rem = 16px)
   - Enables progressive enhancement based on available space

**8px Base Unit System:**
- All margins are multiples of 8px
- Gaps between charts: 16px, 24px, 32px (2×, 3×, 4× base unit)
- Heights: 250px, 300px, 350px, 400px, 450px (all multiples of 50px)
- Ensures visual rhythm and consistency

**Test Coverage:**
- ✅ 54 tests for spacing & layout utilities (all passing)
- ✅ 118 tests for design tokens (from VIZ-009/010/011)
- ✅ **Total: 172 tests passing**
- Tests verify margin calculation, aspect ratio, breakpoints, grid layouts, responsive behavior
- Integration tests ensure margins + inner = total dimensions
- Edge cases tested: tiny containers, huge containers, extreme aspect ratios

**Usage Examples:**
```typescript
import {
  calculateChartMargins,
  calculateChartGrid,
  aspectRatios,
} from '@/lib/designTokens';

// Calculate responsive margins
const margins = calculateChartMargins(800, 400, true, true);

// Maintain 16:9 aspect ratio
const dims = calculateChartDimensions(1000, 600, aspectRatios['16:9']);

// Multi-chart grid layout
const grid = calculateChartGrid(6, containerWidth);
// Returns: { columns: 3, rows: 2, chartWidth: 384, chartHeight: 400, gap: 32 }
```

### File List

**Created:**
- `src/lib/designTokens/spacingUtils.ts` - Spacing & layout utility functions
- `src/lib/designTokens/spacingUtils.test.ts` - Comprehensive tests (54 tests)

**Modified:**
- `src/lib/designTokens/index.ts` - Added spacingUtils exports

## QA Results
_To be filled during QA review_
