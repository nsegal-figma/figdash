---
id: VIZ-011
title: "Typography System"
type: Task
epic: E2
status: Draft
priority: High
storyPoints: 2
sprint: 2
dependencies: ["VIZ-009"]
---

# Story E2.011: Typography System

## Status
Completed

## Story
As a frontend engineer, I want to typography utilities for chart labels So that numbers and text are formatted consistently across all visualizations

## Description


## Acceptance Criteria
1. Typography utility functions created
2. Monospace number formatting
3. Number abbreviation (1.2M, 345K)
4. Date formatting utilities
5. Percentage formatting
6. Currency formatting (multi-locale)
7. Text truncation with ellipsis
8. Responsive font scaling
9. Test all number formats
10. Test edge cases (0, negative, very large)
11. Test truncation

## Tasks / Subtasks

- [x] Task 1: Create number formatting utilities
  - [x] formatNumberAbbreviated() - 1.2M, 345K abbreviation
  - [x] formatCompactNumber() - Intl.NumberFormat compact notation
  - [x] formatSmartNumber() - Auto-selects best format
  - [x] formatMonospaceNumber() - Fixed decimals for tabular data
- [x] Task 2: Add percentage formatting
  - [x] formatPercentage() - Decimal or whole number to percentage
  - [x] Configurable precision
- [x] Task 3: Add currency formatting
  - [x] formatCurrency() - Multi-locale support (USD, EUR, etc.)
  - [x] Uses Intl.NumberFormat for proper locale handling
- [x] Task 4: Add date formatting
  - [x] formatDate() - Short, medium, long, time formats
  - [x] Handles Date objects, strings, timestamps
  - [x] Locale-aware formatting
- [x] Task 5: Add text truncation
  - [x] truncateText() - Ellipsis truncation
  - [x] Handles edge cases (empty, exact length)
- [x] Task 6: Add responsive font scaling
  - [x] getResponsiveFontSize() - Scale based on container width
  - [x] Clamped between 70%-130% of base size
- [x] Task 7: Write comprehensive tests (54 tests, all passing)
  - [x] Number abbreviation tests (K, M, B, T)
  - [x] Percentage formatting tests
  - [x] Currency formatting tests (USD, EUR)
  - [x] Date formatting tests (short, medium, long, time)
  - [x] Text truncation tests
  - [x] Responsive font scaling tests
  - [x] Edge case tests (0, negative, infinity, NaN, very large/small)

## Dev Notes
_To be filled during story planning_

### Testing
_To be filled during story planning_

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-11-19 | 1.0 | Initial story creation from conversion | SM |
| 2025-11-20 | 1.1 | Typography utilities implemented and tested | James (Dev) |

## Dev Agent Record

### Agent Model Used
Claude Sonnet 4.5 (claude-sonnet-4-5-20250929[1m])

### Debug Log References
No debug log required - implementation completed successfully.

### Completion Notes List

**Implementation Summary:**

Created comprehensive typography utility system for formatting numbers, dates, currency, and text in chart labels with consistent, locale-aware formatting.

**Key Features Implemented:**

1. **Number Formatting:**
   - `formatNumberAbbreviated()` - K/M/B/T abbreviations (1.2M, 345K)
   - `formatNumber()` - Locale-aware with thousand separators
   - `formatCompactNumber()` - Intl.NumberFormat compact notation
   - `formatSmartNumber()` - Auto-selects best format (abbreviate large, normal for small)
   - `formatMonospaceNumber()` - Fixed decimals for tabular alignment

2. **Percentage Formatting:**
   - `formatPercentage()` - Decimal (0.75 → 75%) or whole number formatting
   - Configurable precision (0-n decimal places)
   - Handles edge cases (0%, 100%)

3. **Currency Formatting:**
   - `formatCurrency()` - Multi-locale support (USD, EUR, GBP, etc.)
   - Uses Intl.NumberFormat for proper currency symbols and separators
   - Handles negative amounts with locale-specific formatting

4. **Date Formatting:**
   - `formatDate()` - Short, medium, long, time formats
   - Handles Date objects, ISO strings, Unix timestamps
   - Locale-aware (month names, date order)
   - Examples: "Nov 20", "Nov 20, 2025", "November 20, 2025", "12:00 PM"

5. **Text Utilities:**
   - `truncateText()` - Ellipsis truncation for long labels
   - Handles edge cases (empty strings, exact length, maxLength ≤ 3)

6. **Responsive Typography:**
   - `getResponsiveFontSize()` - Scale font based on container width
   - Clamped between 70%-130% of base size (prevents too small/large text)
   - Returns integer pixels for crisp rendering

**Test Coverage:**
- ✅ 54 tests for typography utilities (all passing)
- ✅ 64 tests for color/token system (from VIZ-009/010)
- ✅ **Total: 118 tests passing**
- Tests verify number formatting (K/M/B/T), percentages, currency (USD/EUR), dates, truncation, responsive scaling
- Edge cases tested: 0, negative, infinity, NaN, very large/small numbers

**Integration with Existing System:**
- Uses Intl.NumberFormat and Intl.DateTimeFormat (browser APIs, no dependencies)
- Works with typography tokens from VIZ-009 (font families, sizes, weights)
- No breaking changes to existing components

**Usage Examples:**
```typescript
import { formatSmartNumber, formatPercentage, formatDate } from '@/lib/designTokens';

// In chart axis tick formatter
<XAxis tickFormatter={(value) => formatSmartNumber(value)} />

// In tooltip
<Tooltip formatter={(value) => formatPercentage(value / total)} />

// In date axis
<XAxis tickFormatter={(value) => formatDate(value, 'short')} />
```

### File List

**Created:**
- `src/lib/designTokens/typographyUtils.ts` - Typography utility functions
- `src/lib/designTokens/typographyUtils.test.ts` - Comprehensive tests (54 tests)

**Modified:**
- `src/lib/designTokens/index.ts` - Added typographyUtils exports

## QA Results
_To be filled during QA review_
